version: "3"

dotenv: [".env"]

vars:
  TESTOPTS: -v -race ./...
  BUILDOPTS: -tags netgo,timetzdata -installsuffix netgo -ldflags "-w -s -extldflags -static"

tasks:
  build:
    cmds:
      - go build {{.BUILDOPTS}} {{.CLI_ARGS}}
    env:
      CGO_ENABLED: 0

  dev:
    cmds:
      - go tool air {{.CLI_ARGS}}

  get:
    cmds:
      - go get

  run:
    cmds:
      - go run .

  test:
    cmds:
      - go mod verify
      - go vet ./...
      - go tool gotestsum -- {{.TESTOPTS}}
      - go tool staticcheck ./...

  upgrade:
    cmds:
      - go get -u
      - go mod tidy
